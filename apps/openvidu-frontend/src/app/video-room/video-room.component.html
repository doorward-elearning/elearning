<div *ngIf="!!ovSettings" id="videoRoomNavBar" [class.boundsLight]="lightTheme">
  <app-room-config
    *ngIf="showConfigRoomCard"
    [ovSettings]="ovSettings"
    [externalConfig]="externalConfig"
    (join)="onConfigRoomJoin()"
    (leaveSession)="leaveSession()"
    (publisherCreated)="emitPublisher($event)"
  ></app-room-config>

  <div *ngIf="localUsers && localUsers.length > 0">
    <div *ngIf="isConnectionLost" class="reconnecting-container"></div>

    <mat-sidenav-container class="sidenav-container" id="room-container" [class.boundsLight]="lightTheme" fullscreen>
      <mat-sidenav
        #sidenav
        mode="{{ sidenavMode }}"
        position="end"
        class="sidenav-chat"
        [class.boundsLight]="lightTheme"
        fixedInViewport="true"
        fixedTopGap="0"
        fixedBottomGap="0"
        *ngIf="ovSettings | hasChat"
      >
        <chat-component
          (closeButtonClicked)="toggleNav('chat')"
          *ngIf="sidenavContent === 'chat'"
          #chatComponent
          [lightTheme]="lightTheme"
        ></chat-component>
        <participants-list
          *ngIf="sidenavContent === 'participants'"
          #participantsListComponent
          (closeButtonClicked)="toggleNav('participants')"
        ></participants-list>
      </mat-sidenav>

      <mat-sidenav-content class="sidenav-main">
        <app-active-user-wrapper>
          <app-toolbar
            [lightTheme]="lightTheme"
            [compact]="compact"
            [mySessionId]="mySessionId"
            [sessionTitle]="externalConfig.getSessionTitle() || mySessionId"
            [ovSettings]="ovSettings"
            [hasVideoDevices]="hasVideoDevices"
            [hasAudioDevices]="hasAudioDevices"
            [isWebcamVideoEnabled]="oVSessionService.hasWebcamVideoActive()"
            [isWebcamAudioEnabled]="toolbarMicIconEnabled()"
            [isScreenEnabled]="oVSessionService.isScreenShareEnabled()"
            [isAutoLayout]="isAutoLayout"
            [isConnectionLost]="isConnectionLost"
            (camButtonClicked)="toggleCam()"
            (micButtonClicked)="toggleMic()"
            (screenShareClicked)="toggleScreenShare()"
            (layoutButtonClicked)="toggleSpeakerLayout()"
            (leaveSessionButtonClicked)="leaveSession(true)"
            (participantsListButtonClicked)="toggleNav('participants')"
            (chatButtonClicked)="toggleNav('chat')"
          ></app-toolbar>
        </app-active-user-wrapper>
        <div id="layout" class="bounds" [class.boundsLight]="lightTheme">
          <div class="OT_root OT_publisher custom-class" id="localUser" *ngFor="let localUser of localUsers">
            <!-- Only webcam video will be shown if webcamera is available -->
            <stream-component
              [user]="localUser"
              [videoSizeBig]="localUser.videoSizeBig"
              (nicknameClicked)="onNicknameUpdate($event)"
              (replaceScreenTrackClicked)="onReplaceScreenTrack($event)"
              (toggleVideoSizeClicked)="onToggleVideoSize($event)"
            ></stream-component>
            <div
              class="no-video"
              [style.display]="!localUser.streamManager?.stream?.videoActive ? 'grid' : 'none'"
              [style.background]="greyBackground(localUser.getNickname())"
            >
              <div class="no-video__image">
                <user-avatar
                  fontSize="50px"
                  [name]="localUser.getNickname()"
                  [avatar]="localUser.getAvatar()"
                ></user-avatar>
              </div>
            </div>
          </div>

          <div *ngFor="let user of remoteUsers" class="OT_root OT_publisher custom-class" id="remoteUsers">
            <stream-component
              [user]="user"
              [videoSizeBig]="user.videoSizeBig"
              (toggleVideoSizeClicked)="onToggleVideoSize($event)"
            ></stream-component>
            <div
              class="no-video"
              [style.background]="greyBackground(user.getNickname())"
              [style.display]="!user.streamManager?.stream?.videoActive ? 'grid' : 'none'"
            >
              <div class="no-video__image">
                <user-avatar fontSize="50px" [name]="user.getNickname()" [avatar]="user.getAvatar()"></user-avatar>
              </div>
            </div>
          </div>
        </div>
      </mat-sidenav-content>
    </mat-sidenav-container>
  </div>
</div>
